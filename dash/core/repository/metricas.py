from django.db import connections
from dash.core.helpers.utils import dictfetchall

class Metricas():
    """ Funções para serem utilizado os dados como métricas """

    def severity_sum(self):
        """  Soma os tipos gravidades  """

        with connections["default"].cursor() as cursor:
            _sql = f"""SELECT 
                        sum(case when severity == 'Baixo' THEN 1 ELSE 0 END) AS "Baixo",
                        sum(case when severity == 'Médio' THEN 1 ELSE 0 END) AS "Médio",
                        sum(case when severity == 'Alto' THEN 1 ELSE 0 END) AS "Alto",
                        sum(case when severity == 'Crítico' THEN 1 ELSE 0 END) AS "Crítico"
                    FROM asset_vulnerability"""

            cursor.execute(_sql)
            data = dictfetchall(cursor)

        return data if data else None